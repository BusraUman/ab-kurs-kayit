{% extends "dashboard.html" %}
{% block content %}
{% load staticfiles %}
{% load i18n %}
{% load template_filter %}
{% load trainingtags %}

<script src="{% static '/static/js/courses.js' %}"></script>
<link href="{% static '/static/css/courses.css' %}" rel="stylesheet" type="text/css"/>
<div class="container-fluid" style="margin-top:20px;">
  <div class="alert alert-info">{{ note }}</div>
    {% manuallyaddtrainess site user%}
  <form name="select-student{{course.id}}" method="POST">{% csrf_token %}
  {% for course,value in trainess.items %}
    {% if value %}
      <h4> 
      <span class="avaliable-trainee label">Seçim Yapabilirsiniz</span>
      <span class="label checked-trainee-for-another-course">Katılımcının Diğer Tercihi Onaylanmış</span>
      <span class="label checked-trainee-course">Katılımcı Bu Kurs İçin Onaylanmış</span>
      <span class="label approved-trainess-for-this-course">Katılımcı Bu Kursa Geleceğini Teyit Etti</span>
      </h4>
      </br>
      <div>
      <h2><strong>{{ course.name }}</strong></h2> 
      <!-- issue #52 ile kapatildi -->
      <!--Başvurular Açık: <input id="applicationopen-{{course.id}}" data-id="applicationopen" type="checkbox" checked>-->
      </div>
      <script type="text/javascript">
         $(document).ready(function(){
            {% if course.application_is_open %}
              $("#applicationopen-{{course.id}}").prop("checked");
            {% else %} 
              $("#applicationopen-{{course.id}}").removeAttr("checked");
            {%endif%}
         });
      </script>
    {%endif%}
    {% for pref,trs in value.items %}
    {% if trs %}
      {% if pref > 0 %}
        <h3> {{ pref }}. tercih </h3>
      {% else %}
        <h3> {% mod pref %}. ek tercih </h3>
      {% endif %}
          <table data-id="course_table_control_panel" id="course_table{{course.id}}{{pref}}" class="table table-hover table-striped" >
            <thead>
              <tr>
                  <th>#</th>
                  <th>Basvuru No</th>
                  <th>İsim</th>
                  <th>Soyisim</th>
                  <th>E-posta</th>
                  <th>Sehir</th>
                  <th>
                      {% isdategtnow_head dates pref %}
                  </th>
                  <th>Kabul e-postası gönderildi mi?</th>
                  <th>Ünvan</th>
                  <th>Kurum</th>
                  <th>Üniversite</th>
                  <th>Bölüm</th>
                  <th>Ek Bilgiler</th>
                  <th>Seçilen Kurslar</th>
                  <th>Onaylanma Bilgileri</th>
                  <th>Etkinlik Geçmişi</th>
                  <th>Not Ekle</th>
              </tr>
            </thead>
            <tbody>
              {% for t in trs %}
                <tr>
                  <td>
                    <a class="clickableRow" >Detay</a>
                  </td>
                  <td>{{ t.pk }}</td>
                  <td>{{ t.trainess.user.first_name }}</td>
                  <td>{{ t.trainess.user.last_name }}</td>
                  <td>{{ t.trainess.user.email }}</td>
                  <td>{{ t.trainess.city }}</td>
                  <td>
                    {% for tcr in t.trainess.trainesscourserecord_set.all%}
                     {% if tcr.course.id != course.id %}
                        {%if tcr.approved %}
                              <div class="checked-for-another-course"></div>
                        {% endif%}
                      {% endif%}
                    {%endfor%}
                    {%if t.trainess_approved %}
                              <div class="approved-trainess-for-this-course"></div>
                    {% endif%}
                    {%if t.approved %}
                              <div class="checked-trainee-course"></div>
                    {% endif%}
                    {% isdategtnow_body  dates pref t course user %}
                  </td>
                  <td>
                      {% if t.consentemailsent  %}
                          Evet
                      {% else %}
                          Hayır
                      {% endif %}
                  </td>
                  <td>{{ t.trainess.title }}</td>
                  <td>{{ t.trainess.organization }}</td>
                  <td>{{ t.trainess.university }}</td>
                  <td>{{ t.trainess.department }}</td>
                  <td>{{ t.trainess.additional_information }}</td>
                  <td>
                    {% for tcr in t.trainess.trainesscourserecord_set.all%}
                     {% if tcr.course.id != course.id %}
                          <div> - {{tcr.course.name}} ({{tcr.course.no}}) </br></div>
                      {% endif%}
                    {%endfor%}

                  </td>
                  <td>
                    {% for tcr in t.trainess.trainesscourserecord_set.all%}
                     {% if tcr.course.id != course.id %}
                        {%if tcr.approved %}
                              <div class="checked-for-another-course">Kursiyer {{tcr.preference_order}}. tercihi olan {{tcr.course.name}} kursuna kabul edilmiş</br></div>
                        {% endif%}
                      {% endif%}
                    {%endfor%}
                  </td>
                    <td>
                        {% for journal in t.trainess.note_to_profile.all %}
                            <section>
                                <p>{{ journal.site.name }} - {{ journal.site.year }}</p>
                                <ul>
                                    <li> <b>Notu ekleyen:</b> {{ journal.note_from_profile.user.first_name }} {{ journal.note_from_profile.user.last_name }} {{ journal.note_from_profile.user.username }}</li>
                                    <li> <b>Not:</b><p>{{ journal.note}}</p></li>
                                    <li> <b>Durum:</b><p>Buraya hesaplama sonucu gelecek</p></li>
                                </ul>
                            </section>
                        {% empty %}
                            <p>Bu kullanıcı ile ilgili not girilmemiş</p>
                        {% endfor%}
                    </td>
                     <td>
                           <div class="col-md-1">Not</div>
                           <div class="col-md-6">
                               <input type="text" class="form-control input-note" value=""/>
                               <input type="hidden" class="input-username" value="{{ t.trainess.user.username }}"/>
                           </div>
                           <div class="col-md-2"><input id="save-score" type="button" value="Kaydet"/></div>
 +                  <td>
                </tr>
                {% empty %}
                  <tr><td>Goruntulenecek basvuru yok</td></tr>
                 {% endfor %}
             </tbody>
          </table>

{%endif%}
{% endfor %}
  {% endfor %}
      {% if user.userprofile.can_elect%}
        <div class="alert alert-danger">
            Uyarı: <p>* Onay tarihleri içerisinde kabul e-postaları onayladığınız 1. tercihi kursunuz olan katılımcılara gönderilir.</p>
                   <p>* Kabul e-postası gönderilen kullanıcıların onayını kaldıramazsınız!</p>
                   <p>* Onaylanan diğer (1. tercihi kursunuz olmayan) katılımcıların kabul e-postaları onay tarihi bitiminde gönderilir.</p>
                   <p>* El ile eklediğiniz katılımcıları 1. tercih listesinde görüntüleyebilirsiniz.</p>
        </div>
        <p><input type="checkbox" name="send_consent_email"/>  Kabul e-postaları gönderilsin</p>
        <button type="submit" class="btn btn-success pull-left">Gönder</button>

      {% endif %}

  </form>
  </div>
<!--div id="addprefpopup" class="modal" tabindex="-1" role="dialog" aria-labelledby="addprefpopupLabel">
      <div class="modal-header">
      </div>
      <div class="modal-body">
        <p>One fine body&hellip;</p>
      </div>
      <div class="modal-footer">
      </div>
</div><!-- /.modal -->

  {% endblock %}

